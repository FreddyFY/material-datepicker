"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),MaterialDatepicker=function(){function a(b,c){_classCallCheck(this,a);var d={type:"date",lang:"en",orientation:"landscape",color:"rgba(0, 150, 136, 1)",theme:"light",zIndex:"100",position:null,buttons:!0,openOn:"click",closeAfterClick:!0,date:new Date,weekBegin:"sunday",outputFormat:{date:"YYYY/MM/DD",month:"MMMM YYYY"},topHeaderFormat:"YYYY",headerFormat:{date:"ddd, MMM D",month:"MMM"},sitePickerFormat:{date:"MMMM YYYY",month:"YYYY"},onLoad:null,onOpen:null,onNewDate:null,onChange:null,outputElement:""};if(this.settings=Object.assign(d,c),moment.locale(this.settings.lang),"object"==typeof this.settings.topHeaderFormat&&(this.settings.topHeaderFormat=this.settings.topHeaderFormat[this.settings.type]),"object"==typeof this.settings.headerFormat&&(this.settings.headerFormat=this.settings.headerFormat[this.settings.type]),"object"==typeof this.settings.outputFormat&&(this.settings.outputFormat=this.settings.outputFormat[this.settings.type]),"object"==typeof this.settings.sitePickerFormat&&(this.settings.sitePickerFormat=this.settings.sitePickerFormat[this.settings.type]),this.element=b,"string"==typeof this.element&&(this.element=document.querySelector(""+b),null==this.element))return void console.warn('Material Datepicker could not initialize because, Object: "'+b+'" is not defined');var e=this.element.tagName,f=(this.element.getAttribute("type"),moment().format(this.settings.outputFormat));"INPUT"==e?f=this.element.value:"DIV"==e||"A"==e||"SPAN"==e||"P"==e?0==this.element.children&&(f=this.element.innerHTML):"PAPER-INPUT"==e&&(f=this.element.value);var g=moment(f,this.settings.outputFormat).toDate();isNaN(g.getTime())&&(g=moment().toDate()),this.date=g,"string"==typeof this.settings.outputElement&&""!=this.settings.outputElement&&(this.settings.outputElement=document.querySelector(""+this.settings.outputElement)),this._define()}return _createClass(a,[{key:"_define",value:function(){var a=this;if(this._createElement(),"direct"==this.settings.openOn)return void this.open(this.settings.openOn);this.element.addEventListener(this.settings.openOn,function(){a.open(a.settings.openOn)}),"direct"!=this.settings.openOn&&(document.addEventListener("keyup",function(b){9==b.keyCode&&(document.activeElement==a.element?a.open():a.close())}),document.addEventListener("keyup",function(b){var c=a.element.value,d=moment(c,a.settings.outputFormat).toDate();a.newDate(d,"",!1)}),document.addEventListener("mouseup",function(b){-1==a._getPath(b).indexOf(a.picker)&&a.close()}))}},{key:"_createElement",value:function(a){var b=this,c=(new Date).getTime()+Math.round(Math.random()+2);this.picker=document.createElement("div"),this.picker.setAttribute("class","mp-"+this.settings.type+"picker mp-picker"),this.picker.setAttribute("id","mp-"+c),this.picker.setAttribute("data-theme",this.settings.theme),this.picker.setAttribute("data-orientation",this.settings.orientation);var d=document.createElement("div");d.setAttribute("class","mp-picker-info"),this.picker.appendChild(d);var e=document.createElement("div");e.setAttribute("class","mp-picker-picker"),this.picker.appendChild(e);var f=document.createElement("span");f.setAttribute("class","mp-info-first"),d.appendChild(f);var g=document.createElement("span");g.setAttribute("class","mp-info-second"),d.appendChild(g);var h=document.createElement("div");h.setAttribute("class","mp-picker-site"),e.appendChild(h);var i=document.createElement("a");i.setAttribute("class","mp-picker-site-before mp-picker-site-button"),h.appendChild(i),i.addEventListener("click",function(){b._siteChange(-1)});var j=document.createElement("span");j.setAttribute("class","mp-picker-site-this mp-animate"),h.appendChild(j);var k=document.createElement("a");k.setAttribute("class","mp-picker-site-next mp-picker-site-button"),h.appendChild(k),k.addEventListener("click",function(){b._siteChange(1)});var l=document.createElement("div");l.setAttribute("class","mp-picker-choose mp-animate"),e.appendChild(l);var m="\n      #mp-"+c+'.mp-picker:not([data-theme="dark"]) .mp-picker-info {\n        background-color: '+this.settings.color+";\n      }\n\n      #mp-"+c+'.mp-picker .mp-picker-choose [class*="mp-picker-click"].active,\n      #mp-'+c+'.mp-picker[data-theme="dark"] .mp-picker-choose [class*="mp-picker-click"].active {\n        background-color: '+this.settings.color+";\n      }\n\n      #mp-"+c+'.mp-picker .mp-picker-choose [class*="mp-picker-click"].today:not(.active),\n      #mp-'+c+'.mp-picker[data-theme="dark"] .mp-picker-choose .mp-picker-choose [class*="mp-picker-click"].today:not(.active) {\n        color: '+this.settings.color+";\n      }\n    ",n=document.createElement("style");n.type="text/css",n.appendChild(document.createTextNode(m)),document.querySelector("head").appendChild(n),this.draw(),this.callbackOnLoad()}},{key:"draw",value:function(){var a=this,b=this.picker.querySelector(".mp-picker-choose");if(b.innerHTML="",this.picker.querySelector(".mp-info-first").innerHTML=moment(this.date).format(this.settings.topHeaderFormat),this.picker.querySelector(".mp-info-second").innerHTML=moment(this.date).format(this.settings.headerFormat),this.picker.querySelector(".mp-picker-site-this").innerHTML=moment(this.date).format(this.settings.sitePickerFormat),null!=this.picker.querySelector('[class*="mp-picker-click"].active')&&this.picker.querySelector('[class*="mp-picker-click"].active').classList.remove("active"),"date"==this.settings.type){for(var c=42,d=7,e=0;e<d;e++){var f=e;"monday"==this.settings.weekBegin&&(f+=1)>=d&&(f=0);var g=document.createElement("span");g.setAttribute("class","mp-picker-header mp-picker-header-day-"+e),g.innerHTML=moment.weekdaysMin()[f].substr(0,1),b.appendChild(g)}var h=this.date.getTime();h=new Date(h),h.setDate(1),h.setMonth(h.getMonth()+1),h.setDate(0);var i=h;h=h.getDate(),i.setDate(1),i=i.getDay();for(var j=function(c,d){var e=document.createElement("a");e.setAttribute("class","mp-picker-choose-day");var f=c>=i;"monday"==a.settings.weekBegin&&(f=c+1>=i),f&&d<=h?(e.innerHTML=d,e.classList.add("mp-picker-click-"+d),d++):(e.innerHTML=" ",e.classList.add("mp-empty")),b.appendChild(e),e.addEventListener("click",function(b){if(!a._getPath(b)[0].classList.contains("mp-empty")){var c=d-1,e=a.date;e.setDate(c),"direct"==a.settings.openOn?a.newDate(e):a.newDate(e,"close")}}),k=d},e=0,k=1;e<c;e++)j(e,k);(new Date).getYear()==this.date.getYear()&&(new Date).getMonth()==this.date.getMonth()?this.picker.querySelector(".mp-picker-click-"+1*(new Date).getDate()).classList.add("today"):null!=this.picker.querySelector(".mp-picker-click-"+1*(new Date).getMonth()+".today")&&this.picker.querySelector(".mp-picker-click-"+1*(new Date).getDate()+".today").classList.remove("today"),this.picker.querySelector(".mp-picker-click-"+1*this.date.getDate()).classList.add("active")}else if("month"==this.settings.type){for(var l=12,m=function(c){var d=document.createElement("a");d.setAttribute("class","mp-picker-click-"+c+" mp-picker-choose-month"),d.innerHTML=moment.monthsShort("-MMM-")[c].replace(".",""),b.appendChild(d),d.addEventListener("click",function(){var b=c,d=a.date;d.setMonth(b),"direct"==a.settings.openOn?a.newDate(d):a.newDate(d,"close")})},e=0;e<l;e++)m(e);(new Date).getYear()==this.date.getYear()?this.picker.querySelector(".mp-picker-click-"+1*(new Date).getMonth()).classList.add("today"):null!=this.picker.querySelector(".mp-picker-click-"+1*(new Date).getMonth()+".today")&&this.picker.querySelector(".mp-picker-click-"+1*(new Date).getMonth()+".today").classList.remove("today"),this.picker.querySelector(".mp-picker-click-"+1*this.date.getMonth()).classList.add("active")}}},{key:"_siteChange",value:function(a){var b=this,c={"-1":"left",1:"right"},d={"-1":"right",1:"left"};"date"==this.settings.type?this.date=moment(this.date).add(a,"month").toDate():"month"==this.settings.type&&(this.date=moment(this.date).add(a,"year").toDate()),this.picker.querySelectorAll(".mp-animate")[0].classList.add("mp-animate-"+d[a]),this.picker.querySelectorAll(".mp-animate")[1].classList.add("mp-animate-"+d[a]),setTimeout(function(){b.picker.querySelectorAll(".mp-animate")[0].classList.remove("mp-animate-"+d[a]),b.picker.querySelectorAll(".mp-animate")[0].classList.add("mp-animate-"+c[a]),b.picker.querySelectorAll(".mp-animate")[1].classList.remove("mp-animate-"+d[a]),b.picker.querySelectorAll(".mp-animate")[1].classList.add("mp-animate-"+c[a]),b.draw(),setTimeout(function(){b.picker.querySelectorAll(".mp-animate")[0].classList.remove("mp-animate-"+c[a]),b.picker.querySelectorAll(".mp-animate")[1].classList.remove("mp-animate-"+c[a]),b.newDate(b.date)},200)},200)}},{key:"open",value:function(a){if("direct"==a&&"DIV"==this.element.tagName)this.element.appendChild(this.picker);else{var b=this.element.tagName,c=this.element.getAttribute("type"),d=this.element.value;("INPUT"!=b||"date"!=c&&"number"!=c&&"text"!=c)&&"PAPER-INPUT"!=b||""==d||(this.date=moment(d,this.settings.outputFormat).toDate()),document.body.appendChild(this.picker);var e=10,f=this._findTotalOffset(this.element),g=f.top+f.height+e,h=f.left,i=i=Math.max(document.documentElement.clientWidth,window.innerWidth||0),j=j=Math.max(document.documentElement.clientHeight,window.innerHeight||0),k=this._findTotalOffset(this.picker);h+k.width+50>i&&(h=h-k.width-e),g+k.height+20>j&&(g=g-k.height-f.height-e),this.picker.style.top=g+"px",this.picker.style.left=h+"px"}this.picker.style.zIndex=this.settings.zIndex,null!=this.settings.position&&(this.picker.style.position=this.settings.position),this.newDate(null),this.callbackOnOpen()}},{key:"close",value:function(){this.picker&&this.picker.parentNode&&this.picker.parentNode.removeChild(this.picker)}},{key:"_writeInElement",value:function(){var a=moment(this.date).format(this.settings.outputFormat);("INPUT"==this.element.tagName&&"text"==this.element.getAttribute("type")||"DIV"==this.element.tagName||"PAPER-INPUT"==this.element.tagName)&&(this.element.value=a),this.settings.outputElement&&"INPUT"!=this.settings.outputElement.tagName&&(this.settings.outputElement.innerHTML=a)}},{key:"newDate",value:function(a,b){var c=arguments.length<=2||void 0===arguments[2]||arguments[2],d=a||this.date;isNaN(d.valueOf())&&(d=this.settings.date),d.setMilliseconds(0),d.setSeconds(0),d.setMinutes(0),d.setHours(0),this.date=d,this.draw(),c&&this._writeInElement(),this.callbackOnChange(),"close"==b&&(this.close(),this.callbackOnNewDate())}},{key:"callbackOnLoad",value:function(){"function"==typeof this.settings.onLoad&&this.settings.onLoad.call(this,this.date)}},{key:"callbackOnOpen",value:function(){"function"==typeof this.settings.onOpen&&this.settings.onOpen.call(this,this.date)}},{key:"callbackOnNewDate",value:function(){"function"==typeof this.settings.onNewDate&&this.settings.onNewDate.call(this,this.date)}},{key:"callbackOnChange",value:function(){"function"==typeof this.settings.onChange&&this.settings.onChange.call(this,this.date)}},{key:"_findTotalOffset",value:function(a){var b=void 0,c=void 0;b=c=0;var d=a.getBoundingClientRect();if(a.offsetParent)do{b+=a.offsetLeft,c+=a.offsetTop}while(a=a.offsetParent);return{left:b,top:c,height:d.height,width:d.width}}},{key:"_getPath",value:function(a){for(var b=[],c=a.target;c;)b.push(c),c=c.parentElement;return-1===b.indexOf(window)&&-1===b.indexOf(document)&&b.push(document),-1===b.indexOf(window)&&b.push(window),b}}]),a}();